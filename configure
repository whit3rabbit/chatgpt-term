#!/bin/sh

set -e

prefix="/usr"
includedir="/usr/include"
libdir="/usr/lib"

if [ "$(uname -m)" = "x86_64" ]; then
    CC="gcc"
elif [ "$(uname -m)" = "aarch64" ]; then
    CC="aarch64-linux-gnu-gcc"
elif [ "$(uname -m)" = "armv7l" ]; then
    CC="arm-linux-gnueabihf-gcc"
else
    echo "Unsupported architecture: $(uname -m)"
    exit 1
fi

CFLAGS="-Wall -Wextra -O2 -g"
CFLAGS="${CFLAGS} -I${includedir} -I${includedir}/cjson/"
CFLAGS="${CFLAGS} -I/usr/local/include/cjson/ -I/usr/local/include"

LDFLAGS="-L${libdir} -L/usr/local/lib"
LDFLAGS="${LDFLAGS} -lcurl -lcjson -lssl -lcrypto -lpthread -lz -ldl"

cat << EOF > config.mk
CC=${CC}
CFLAGS=${CFLAGS}
LDFLAGS=${LDFLAGS}
PREFIX=${prefix}
EOF

echo "Configuration complete. You can now run 'make'."